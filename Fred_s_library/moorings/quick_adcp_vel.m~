function quick_adcp_vel(adcpfile, bottomfile, tlim, tbin, theta)

% usage ex:
% quick_adcp_vel('adcp_20120808.mat', '../ECHO-SOUNDER/bottom.mat', [datenum(2012, 08, 08, 10, 15, 0) datenum(2012, 08, 08, 23, 05, 0)], 600, 33.5)
%   
% bottom.mat is generated by bottomDetection.m
% tbin in seconds
  
    
tbin = tbin/86400; % tbin in days    
load(adcpfile)    
load(bottomfile)

U = ADCP.east_vel;
V = ADCP.north_vel;
mtime = ADCP.mtime;
z = ADCP.config.ranges;

if bottomTime(1)>tlim(1) | mtime(1)>tlim(1)
    tlim(1) = max([bottomTime(1), mtime(1)]);
end
if bottomTime(end)<tlim(2) | mtime(end)<tlim(2)
    tlim(2) = min([bottomTime(end), mtime(end)]);
end
    
timeVec = tlim(1):tbin:tlim(2);


% correct for boat drift
[ucor, vcor] = adcp_velcor(U, V, mtime, '../GPS/20120808');

%I = find(mtime >= tlim(1) & mtime <= tlim(2));
[valong, vcross]=rotate_vecd(ucor, vcor, theta);

Ubin = nan(length(z), length(timeVec));
Vbin = nan(length(z), length(timeVec));

keyboard
% Remove bottom
for i = 1:length(mtime)
    [Y, I] = min(abs(mtime(i)-bottomTime));
    bot(i) = bottom(I);
end



for i = 1:length(timeVec)
    I = find(mtime>=timeVec(i)-tbin/2 & mtime<=timeVec(i)+tbin/2);
    Ubin(:,i) = nanmean(valong(:,I), 2);
    Vbin(:,i) = nanmean(vcross(:,I), 2);
end



figure(1)
clf
subplot(211)
imagesc(timeVec, z, Ubin*100)
caxis([-25 25])
colorbar


subplot(212)
imagesc(timeVec, z, Vbin*100)
caxis([-25 25])
colorbar
